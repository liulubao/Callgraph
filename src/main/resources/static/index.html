<!DOCTYPE html>
<!-- release v4.3.6, copyright 2014 - 2016 Kartik Visweswaran -->
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Java Call Graph </title>
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
    <script src="./js/jquery.min.js"></script>
    <script src="./js/fileinput.js" type="text/javascript"></script>
    <!--<script src="../js/fileinput_locale_fr.js" type="text/javascript"></script>-->
    <!--<script src="./js/fileinput_locale_es.js" type="text/javascript"></script>-->
    <!--<script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js" type="text/javascript"></script>-->
    <script src="./js/bootstrap.js" type="text/javascript"></script>
    <script src="./js/bootstrapValidator.js" type="text/javascript"></script>
    <link href="./css/bootstrapValidator.css" media="all" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="./js/bootbox.min.js"></script>
    <link href="css/carousel.css" rel="stylesheet">
    <script type="text/javascript" src="./js/canvas-particle.js"></script>
    <script src="./js/bootstrap-table.js"></script>
    <script src="./js/locales/bootstrap-table-zh-CN.js"></script>
    <link href="./css/bootstrap-table.css" rel="stylesheet">
    <link href="./css/navbarcolor.css" rel="stylesheet">

</head>
<body>

<nav class="navbar navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">代码依赖分析与展示平台</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">首页</a></li>
                <li class="dependency"><a href="index2.html">依赖图</a></li>
                <!--<li><a href="javascript:void(0);">Contact</a></li>-->
                <li class="dropdown dependency">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">个人主页 <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="indexinfo.html">个人信息</a></li>
                        <li><a href="indexproject.html">我的项目</a></li>
                        <li><a href="indexlabel.html">我的标签</a></li>
                    </ul>
                </li>
            </ul>
            <ul id="nav1" class="nav navbar-nav navbar-right">
                <li style="float: right"><a data-toggle="modal" data-target="#register_window" href=""><span class="glyphicon glyphicon-user"></span> 注册</a></li>
                <li style="float: right"><a data-toggle="modal" data-target="#login_window" href=""><span class="glyphicon glyphicon-log-in"></span> 登录</a></li>
            </ul>
            <ul id="nav2" class="nav navbar-nav navbar-right" >
                <li style="float: right"><a id="poptest"  href="#"></a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="jumbotron">
    <div id="mydiv">

    </div>
    <div class="container">
        <div class="page-header">
            <h1>Java CallGraph Analysis</h1>
            <p>请输入一个https格式的java maven工程的git地址</p>
        </div>
        <div class="input-group">
            <input id="urlcontent" type="text" class="form-control">
            <!--<input type="text" name="nope" id="nope" placeholder="Crayola colors" maxlength="40" />-->
            <span class="input-group-btn">
                <button id="urlsearch" class="btn btn-primary" type="button">Search!</button>
            </span>
        </div>
    </div>
</div>

<div class="container marketing">
    <div id="nolanding">
        <div class="nolanding" style="text-align: center;display: block">
            <a data-toggle="modal" data-target="#register_window" href="" >还没有注册？点击注册吧，注册之后您将拥有以下功能</a>
        </div>
        <div class="nolanding" class="row" style="display:block;">
            <div class="col-md-4">
                <h2>项目记录</h2>
                <p>你所分析的项目将会被保存记录，方便您在下一次登陆的时候可以直接查看依赖并进行相关操作，不必再重复上传。</p>
                <p><a class="btn btn-default" href="#" role="button" data-toggle="modal" data-target="#login_window" href="" >登陆&raquo;</a></p>
            </div>
            <div class="col-md-4">
                <h2>标记记录</h2>
                <p>您可以对项目分析得到的依赖图的结点打一些label,这些label可以帮助你更好的理解、分析整个项目，同时，和你进行项目分析的队友也可看到您的label。</p>
                <p><a class="btn btn-default" href="#" role="button" data-toggle="modal" data-target="#login_window" href="" >登陆&raquo;</a></p>
            </div>
            <div class="col-md-4">
                <h2>项目合作</h2>
                <p>您可以添加好友、私信聊天等来得到一些项目合作的队友，您还可以将自己的项目分享给别人使得自己团队的队友可以对同一个项目进行操作</p>
                <p><a class="btn btn-default" href="#" role="button" data-toggle="modal" data-target="#login_window" href="" >登陆&raquo;</a></p>
            </div>
        </div>
        <div>
            <hr class="featurette-divider">
        </div>
    </div>
    <!--<hr class="featurette-divider">-->
    <div id="landed" style="display:block;">
        <div class="row featurette" >
            <div class="col-md-5">
                <h2 class="featurette-heading">最近项目</h2>
                <p class="lead">这是你最近操作的项目，你可以点击查看依赖继续之前的操作</p>
            </div>
            <div class="col-md-7" >
                <table id="projectTable" class="featurette-tabless" data-unique-id="idx" style="word-break:break-all;"></table>
            </div>
        </div>
        <hr class="featurette-divider">
        <div class="row featurette">
            <div class="col-md-5 col-md-push-7">
                <h2 class="featurette-heading">最近标记</h2>
                <p class="lead">这是你最近添加的标签，你可以点击查看该标签所属的依赖继续之前的操作</p>
            </div>
            <div class="col-md-7 col-md-pull-5">
                <table id="labelTable" style="word-break:break-all"></table>
            </div>
        </div>
        <hr class="featurette-divider">

        <div class="row featurette">
            <div class="col-md-5">
                <h2 class="featurette-heading">最近改变</h2>
                <p class="lead">这是你的项目最近新增加的标记</p>
            </div>
            <div class="col-md-7">
                <table id="lastTable" style="word-break:break-all"></table>
            </div>
        </div>
    </div>


    <hr class="featurette-divider">
    <!-- /END THE FEATURETTES -->
    <!-- FOOTER -->
    <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>© 2019 NJU, Inc. ·
            <!--<a href="#">Privacy</a> · <a href="#">Terms</a>-->
        </p>
    </footer></div>


<!-- 个人信息窗口 -->
<div id="message" class="modal">

</div>
<!-- 注册窗口 -->
<div id="register_window" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">注册</h1>
            </div>
            <!--<div class="modal-header">-->
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
                <!--<h4 class="modal-title">Modal title</h4>-->
            <!--</div>-->
            <div class="modal-body">
                <form id="register_form" class="form-group" action="">
                    <div class="form-group">
                        <label for="">登陆用户名</label>
                        <input name="loginname" id="loginname" class="form-control" type="text" placeholder="6-15位字母或数字">
                    </div>
                    <div class="form-group">
                        <label for="">显示昵称</label>
                        <input name="viewname" id="viewname" class="form-control" type="text" placeholder="6-15位字母或数字">
                    </div>
                    <div class="form-group">
                        <label for="">密码</label>
                        <input name="password" id="password" class="form-control" type="password" placeholder="至少6位字母或数字">
                    </div>
                    <div class="form-group">
                        <label for="">再次输入密码</label>
                        <input name="confirmPassword" id="confirmPassword" class="form-control" type="password" placeholder="至少6位字母或数字">
                    </div>
                    <div class="form-group">
                        <label for="">邮箱</label>
                        <input name="email" id="email" class="form-control" type="email" placeholder="例如:123@123.com">
                    </div>
                    <!--<div class="modal-footer">-->
                        <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
                        <!--<button type="button" class="btn btn-primary">Save changes</button>-->
                    <!--</div>-->
                    <div style="float:right">
                        <span id="register_tip_btn" class="register_tip_btn login_tip_btn tip text-danger"></span>
                        <button id="register_submit" class="btn btn-primary">提交</button>
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#login_window">已有账号？点我登录</a>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- 登录窗口 -->
<div id="login_window" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <button class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-title">
                <h1 class="text-center">登录</h1>
            </div>
            <div class="modal-body">
                <form id="login_form" class="form-group" action="">
                    <div class="form-group">
                        <label for="">用户名</label>
                        <input id="lloginname" name="loginname" class="form-control" type="text" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="">密码</label>
                        <input id="lpassword" name="password" class="form-control" type="password" placeholder="">
                    </div>
                    <div class="text-right">
                        <!--<span id="tip_btn1" class="tip_btn tip text-danger" style="display: none">不存在该用户</span>-->
                        <span id="login_tip_btn" class="login_tip_btn tip text-danger" style="display: none"></span>
                        <button id="login_submit" class="btn btn-primary">登录</button>
                        <button class="btn btn-danger" data-dismiss="modal">取消</button>
                    </div>
                    <a href="" data-toggle="modal" data-dismiss="modal" data-target="#register_window">还没有账号？点我注册</a>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    window.onload = function() {
        //配置
        var config = {
            vx: 4,	//小球x轴速度,正为右，负为左
            vy: 4,	//小球y轴速度
            height: 2,	//小球高宽，其实为正方形，所以不宜太大
            width: 2,
            count: 200,		//点个数
            color: "121, 162, 185", 	//点颜色
            stroke: "130,255,255", 		//线条颜色
            dist: 6000, 	//点吸附距离
            e_dist: 20000, 	//鼠标吸附加速距离
            max_conn: 10 	//点到点最大连接数
        }

        //调用
        CanvasParticle(config);
    }
</script>
</body>
<script>

    $('#test').click(function () {
        bootbox.alert("Your message here…")
        // $('#nav1').toggle();
        // $('#nav2').toggle();
    })
    $("#register_submit").click(function () {
        $("#register_form").bootstrapValidator('validate');//提交验证
        if ($("#register_form").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
            var loginname = $("#loginname").val();
            var viewname = $("#viewname").val();
            var password = $("#password").val();
            var email = $("#email").val();
            $.ajax({
                type: 'POST',
                url: "/user/register",
                // dataType: 'json',
                contentType: 'application/json',
                <!-- headers: { 'userName': username, 'password': password }, -->
                data:'{"loginname":"'+loginname+'","viewname":"'+viewname+'","password":"'+password+'","email":"'+email+'"}',
                success: function (data) {
                    // setCookie("session-id", data.sessiondId, false);
                    // window.alert('注册成功！');
                    // $('#register_form').modal('hide');
                    if(data.status==1){
                        bootbox.alert("注册成功");
                        $('#register_window').modal('hide');
                        setCookie("dependency_viewname",viewname,30);
                        setCookie("dependency_loginname",loginname,30);
                        // setCookie("dependency_password",password,30);
                        document.getElementById('nav1').style.display='none';
                        document.getElementById('nav2').style.display='block';
                        document.getElementById('poptest').innerHTML=viewname+'<span class="glyphicon glyphicon-user"></span>';
                        location.reload()
                    }else{
                        // bootbox.alert("注册s失败");
                        document.getElementById('register_tip_btn').innerHTML='注册失败，账号已注册或信息有误'
                    }

                },
                error: function(data) {
                    console.log(data);
                    window.alert('注册失败！' + data);
                },
            })
        }
    })
    $("#login_submit").click(function () {
        $("#login_form").bootstrapValidator('validate');//提交验证
        if ($("#login_form").data('bootstrapValidator').isValid()) {//获取验证结果，如果成功，执行下面代码
            var loginname = $("#lloginname").val();
            // var viewname = $("#viewname").val();
            var password = $("#lpassword").val();
            // var email = $("#email").val();
            $.ajax({
                type: 'POST',
                url: "/user/login",
                // dataType: 'json',
                // contentType: 'application/json',
                <!-- headers: { 'userName': username, 'password': password }, -->
                data:{"username":loginname,"password":password,},
                success: function (data,textStatus,response) {
                    // setCookie("session-id", data.sessiondId, false);
                    // window.alert('登陆成功！');
                    // $('#register_form').modal('hide');
                    console.log("1111:"+data);
                    if(data.status == 0){
                        // alert('登陆失败，密码不正确或者账号不存在')
                        $('.login_tip_btn').toggle();
                        document.getElementById('login_tip_btn').innerHTML='密码不正确或者账号不存在'
                    }else if(data.status == 1){
                        console.log(response);
                        var tokenid = response.getResponseHeader("Authorization");
                        // alert('登陆成功'+data.result.loginname)
                        setCookie("token",data.token,30);
                        setCookie("dependency_viewname",data.result.viewname,30);
                        setCookie("dependency_loginname",data.result.loginname,30);
                        // setCookie("dependency_password",data.result.password,30);
                        $('#login_window').modal('hide');
                        document.getElementById('nav1').style.display='none';
                        document.getElementById('nav2').style.display='block';
                        document.getElementById('poptest').innerHTML=data.result.viewname+'<span class="glyphicon glyphicon-user"></span>';
                    }
                },
                error: function(data) {
                    console.log(data);
                    bootbox.alert("登陆失败111"+data);
                },
            })
        }
    })
    function setCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = escape(name) + "=" + (unescape(value) || "")  + expires + "; path=/";
    }
    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function loginout() {
        $('#nav1').toggle();
        $('#nav2').toggle();
        document.getElementById('landed').style.display='none';
        document.getElementById('nolanding').style.display='block';
        setCookie("dependency_loginname","");
        setCookie("dependency_viewname","");
        setCookie("dependency_projectid","");
        var projectid = getCookie('dependency_projectid');
        if(projectid!=""&&projectid!=null&&projectid!=undefined){
            $('.dependency').css('display','block')
        }else{
            $('.dependency').css('display','none')
        }
    }

    $("#urlsearch").click(function () {
        var url = $("#urlcontent").val();
        var loginname = getCookie("dependency_loginname");
        if(!isnull(url)){
            $.ajax({
                type: 'POST',
                url: "/file/uploadurl",
                timeout:50000000,
                // dataType: 'json',
                // contentType: 'application/json',
                <!-- headers: { 'userName': username, 'password': password }, -->
                data:{"username":loginname,"url":url,},
                success: function (data) {
                    if(data.status == 0){
                        // alert('登陆失败，密码不正确或者账号不存在')
                        $('.login_tip_btn').toggle();
                        document.getElementById('login_tip_btn').innerHTML='密码不正确或者账号不存在'
                    }else if(data.status == 1){
                        // alert('处理成功'+data.response.jar_id);
                        bootbox.alert("分析成功,准备前往依赖分析界面")
                        setCookie("dependency_projectid",data.jar_id);
                        // alert(getCookie("dependency_projectid"));
                        window.location.href="index2.html"
                    }else if (data.status == 2){
                        bootbox.alert("请检查地址是否为https格式的java maven工程的git地址")
                    }else if (data.status == 3){
                        bootbox.alert("该项目不是一个java的maven工程")
                    }

                },
                error: function(xhr,textStatus){
                    if(textStatus=='timeout'){
                        //处理超时的逻辑
                        bootbox.alert("超时了！")
                    }
                    else{
                        //其他错误的逻辑
                        bootbox.alert("使用https格式的地址或者检查是否时是java的maven工程！")
                    }
                }
                // error: function(data) {
                //     console.log(data);
                //     bootbox.alert("登陆失败"+data);
                // },
            })
        }
    })


    function personmsg() {
        alert('个人信息')
    }


    var TableInit = function () {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $('#projectTable').bootstrapTable({
                url: '/project/getrecentproject',         //请求后台的URL（*）
                method: 'GET',                      //请求方式（*）
                toolbar: '#toolbar',                //工具按钮用哪个容器
                striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: false,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                queryParams: oTableInit.queryParams,//传递参数（*）
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 5,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                // contentType: "application/json",
                ajaxOptions:{
                    headers: {"Authorization":getCookie("token")}
                },
                strictSearch: false,
                showColumns: false,                  //是否显示所有的列
                showRefresh: false,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: false,                //是否启用点击选中行
                height: 400,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "projectid",                     //每一行的唯一标识，一般为主键列
                showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表
                columns: [
                    {
                        field: 'projectname',
                        title: '项目名称'
                    }, {
                        field: 'createtime',
                        title: '操作时间'
                    },
                    {
                        field: 'operate',
                        title: '操作',
                        events: operateEvents1,
                        formatter: operateFormatter //自定义方法，添加操作按钮
                    },
                ],
                rowStyle: function (row, index) {
                    // var classesArr = ['success', 'info'];
                    var strclass = "";
                    if (index % 2 === 0) {//偶数行
                        // strclass = classesArr[0];
                        strclass="active"
                    } else {//奇数行
                        // strclass = classesArr[1];
                    }
                    return { classes: strclass };
                },//隔行变色
            });

        };

        //得到查询的参数
        oTableInit.queryParams = function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                limit: 5,   //页面大小
                offset:0,
                username:getCookie("dependency_loginname"),
                sort: params.createtime,      //排序列名
                sortOrder: "desc" //排位命令（desc，asc）
                // limit: 10,   //页面大小
                // offset:10,
            };
            return temp;
        };
        return oTableInit;
    };

    function operateFormatter(value, row, index) {//赋予的参数
        console.log('value:'+value);
        console.log('row:'+row.projectid);
        console.log('index:'+index);
        return [
            // '<a class="btn active disabled" href="#">编辑</a>',
            // '<a class="lshare btn btn-default" href="#" value="row.projectid" data-toggle="modal" data-target="#myModal">分享</a>',
            '<a class="ldetail btn btn-default" href="#" value="row.projectid">查看依赖</a>',
            // '<a class="ldelete btn btn-danger" href="#" value="row.projectid">删除</a>',
            // '<a class="btn active" href="#">准入</a>'
        ].join('');
    }

    window.operateEvents1 = {
        // 'click .lshare': function(e, value, row, index) {
        //     // $('#share').val(row.projectid);
        //     alert("test")
        // },
        'click .ldetail': function(e, value, row, index) {
            // alert(row.createtime)
            // $(this).hidden
            // var uid=$(this).parent().parent().attr("data-uniqueid");
            // console.log(uid)
            setCookie("dependency_projectid",row.projectid,24);
            window.location.href="index2.html"
        },
        // 'click .ldelete': function(e, value, row, index) {
        //     alert(row.createtime)
        //     // $(this).parent().parent().remove();
        //     var uid = row.projectid;
        //     $('#projectTable').bootstrapTable('removeByUniqueId', uid);
        // }

    };

    function isnull(val) {
        // var str = val.replace(/(^\s*)|(\s*$)/g, '');//去除空格;n
        var str = val;
        if (str == '' || str == undefined || str == null) {
            return true;
            // console.log('空')
        } else {
            return false;
            // console.log('非空');
        }
    }

    var labeloTableInit = function () {
        var labeloTableInit = new Object();
        //初始化Table
        labeloTableInit.Init = function () {
            $('#labelTable').bootstrapTable({
                url: '/label/getbyusername',         //请求后台的URL（*）
                method: 'GET',                      //请求方式（*）
                toolbar: '#toolbar',                //工具按钮用哪个容器
                striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: false,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                queryParams: labeloTableInit.queryParams,//传递参数（*）
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 5,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                // contentType: "application/x-www-form-urlencoded",
                ajaxOptions:{
                    headers: {"Authorization":getCookie("token")}
                },
                strictSearch: true,
                showColumns: false,                  //是否显示所有的列
                showRefresh: false,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: false,                //是否启用点击选中行
                height: 400,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "projectid",                     //每一行的唯一标识，一般为主键列
                showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表
                columns: [
                    {
                        field: 'title',
                        title: '标签名称'
                    },
                    // {
                    //     field: 'content',
                    //     title: '标签内容'
                    // },
                    {
                        field: 'parentelement',
                        title: '所属方法'
                    },{
                        field: 'createtime',
                        title: '标记时间'
                    },
                    {
                        field: 'operate',
                        title: '操作',
                        events: operateEvents1label,
                        formatter: operateFormatterlabel //自定义方法，添加操作按钮
                    },
                ],
                rowStyle: function (row, index) {
                    // var classesArr = ['success', 'info'];
                    var strclass = "";
                    if (index % 2 === 0) {//偶数行
                        // strclass = classesArr[0];
                        strclass="active"
                    } else {//奇数行
                        // strclass = classesArr[1];
                    }
                    return { classes: strclass };
                },//隔行变色
            });

        };

        //得到查询的参数
        labeloTableInit.queryParams = function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                limit: 5,   //页面大小
                offset:0,
                username:getCookie("dependency_loginname"),
                // limit: 10,   //页面大小
                // offset:10,
            };
            return temp;
        };
        return labeloTableInit;
    };

    function operateFormatterlabel(value, row, index) {//赋予的参数
        console.log('value:'+value);
        console.log('row:'+row.projectid);
        console.log('index:'+index);
        return [
            // '<a class="btn active disabled" href="#">编辑</a>',
            '<a class="ldetail btn btn-default" href="#" value="row.projectid">查看依赖</a>',
            // '<a class="ldelete btn btn-danger" href="#" value="row.projectid">删除</a>',
            // '<a class="btn active" href="#">准入</a>'
        ].join('');
    }

    window.operateEvents1label = {
        'click .ldetail': function(e, value, row, index) {
            // alert(row.createtime)
            // $(this).hidden
            // var uid=$(this).parent().parent().attr("data-uniqueid");
            // console.log(uid)
            setCookie("dependency_projectid",row.projectid,24);
            window.location.href="index2.html"
        },
        // 'click .ldelete': function(e, value, row, index) {
        //     alert(row.createtime)
        //     // $(this).parent().parent().remove();
        //     var uid = row.projectid;
        //     $('#projectTable').bootstrapTable('removeByUniqueId', uid);
        // }
    };


    var lastoTableInit = function () {
        var lastoTableInit = new Object();
        //初始化Table
        lastoTableInit.Init = function () {
            $('#lastTable').bootstrapTable({
                url: '/label/getlastestlabel',         //请求后台的URL（*）
                method: 'GET',                      //请求方式（*）
                toolbar: '#toolbar',                //工具按钮用哪个容器
                striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: false,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                queryParams: lastoTableInit.queryParams,//传递参数（*）
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 5,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                // contentType: "application/x-www-form-urlencoded",
                ajaxOptions:{
                    headers: {"Authorization":getCookie("token")}
                },
                strictSearch: true,
                showColumns: false,                  //是否显示所有的列
                showRefresh: false,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: false,                //是否启用点击选中行
                height: 400,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "projectid",                     //每一行的唯一标识，一般为主键列
                showToggle: false,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表
                columns: [
                    {
                        field: 'title',
                        title: '标签名称'
                    },
                    // {
                    //     field: 'content',
                    //     title: '标签内容'
                    // },
                    {
                        field: 'parentelement',
                        title: '所属方法'
                    },{
                        field: 'createtime',
                        title: '标记时间'
                    },
                    {
                        field: 'operate',
                        title: '操作',
                        events: operateEvents1last,
                        formatter: operateFormatterlast //自定义方法，添加操作按钮
                    },
                ],
                rowStyle: function (row, index) {
                    // var classesArr = ['success', 'info'];
                    var strclass = "";
                    if (index % 2 === 0) {//偶数行
                        // strclass = classesArr[0];
                        strclass="active"
                    } else {//奇数行
                        // strclass = classesArr[1];
                    }
                    return { classes: strclass };
                },//隔行变色
            });

        };

        //得到查询的参数
        lastoTableInit.queryParams = function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                limit: 5,   //页面大小
                offset:0,
                username:getCookie("dependency_loginname"),
                // limit: 10,   //页面大小
                // offset:10,
            };
            return temp;
        };
        return lastoTableInit;
    };

    function operateFormatterlast(value, row, index) {//赋予的参数
        console.log('value:'+value);
        console.log('row:'+row.projectid);
        console.log('index:'+index);
        return [
            // '<a class="btn active disabled" href="#">编辑</a>',
            '<a class="ldetail btn btn-default" href="#" value="row.projectid">查看依赖</a>',
            // '<a class="ldelete btn btn-danger" href="#" value="row.projectid">删除</a>',
            // '<a class="btn active" href="#">准入</a>'
        ].join('');
    }

    window.operateEvents1last = {
        'click .ldetail': function(e, value, row, index) {
            // alert(row.createtime)
            // $(this).hidden
            // var uid=$(this).parent().parent().attr("data-uniqueid");
            // console.log(uid)
            setCookie("dependency_projectid",row.projectid,24);
            window.location.href="index2.html"
        },
        // 'click .ldelete': function(e, value, row, index) {
        //     alert(row.createtime)
        //     // $(this).parent().parent().remove();
        //     var uid = row.projectid;
        //     $('#projectTable').bootstrapTable('removeByUniqueId', uid);
        // }
    };

    $(document).ready(function() {

        //1.初始化Table
        var oTable = new TableInit();
        oTable.Init();

        var labeloTable = new labeloTableInit();
        labeloTable.Init();

        var lastoTable = new lastoTableInit();
        lastoTable.Init();

        var viewname = getCookie('dependency_viewname');
        if(viewname!=""&&viewname!=null&&viewname!=undefined){
            document.getElementById('nav1').style.display='none';
            document.getElementById('nav2').style.display='block';
            document.getElementById('landed').style.display='block';
            document.getElementById('nolanding').style.display='none';
            $('.dropdown').css("display","block");
            document.getElementById('poptest').innerHTML=viewname+'<span class="glyphicon glyphicon-user"></span>';
        }else{
            // document.getElementById('poptest').innerHTML='';
            document.getElementById('nav2').style.display='none';
            document.getElementById('nav1').style.display='block';
            document.getElementById('landed').style.display='none';
            document.getElementById('nolanding').style.display='block';
            $('.dropdown').css("display","none");
        }

        var projectid = getCookie('dependency_projectid');
        if(projectid!=""&&projectid!=null&&projectid!=undefined){
            $('#dependency').css('display','block')
        }else{
            $('#dependency').css('display','none')
        }

        $('#poptest').each(function () {
            var element = $(this);
            var id = element.attr('id');
            var txt = element.html();
            element.popover({
                trigger: 'manual',
                placement: 'bottom', //top, bottom, left or right
                title: '',
                html: 'true',
                content: ContentMethod(txt),

            }).on("mouseenter", function () {
                var _this = this;
                $(this).popover("show");
                $(this).siblings(".popover").on("mouseleave", function () {
                    $(_this).popover('hide');
                });
            }).on("mouseleave", function () {
                var _this = this;
                setTimeout(function () {
                    if (!$(".popover:hover").length) {
                        $(_this).popover("hide")
                    }
                }, 100);
            });
        });
        function ContentMethod(txt) {
            return '<div class="list-group"> ' +
                '<a id="message" href="indexmessagelist.html" onclick="mssg()" class="list-group-item">私信</a> ' +
                '<a id="message" href="indexinfo.html" onclick="mssg()" class="list-group-item">个人信息 </a> ' +
                '<a id="loginout" href="javascript:;" onclick="loginout()" class="list-group-item">退出登陆</a> ' +
                '</div>';
        }

        $('#register_form').bootstrapValidator({
//        live: 'disabled',
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                loginname: {
                    validators: {
                        notEmpty: {
                            message: '登录名不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '瞪目名称长度在6-15个字母/数字之间'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\.]+$/,
                            message: '登录名只能包含字符数字'
                        },
                    }
                },
                viewname: {
                    validators: {
                        notEmpty: {
                            message: '昵称不能为空'
                        }
                    }
                },
                email: {
                    validators: {
                        emailAddress: {
                            message: '这不是一个有效的邮箱格式'
                        }
                    }
                },
                password: {
                    validators: {
                        notEmpty: {
                            message: '密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '密码长度在6-15个字符之间'
                        },
                    }
                },
                confirmPassword: {
                    validators: {
                        notEmpty: {
                            message: '确认密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '密码长度在6-15个字符之间'
                        },
                        identical: {
                            field: 'password',
                            message: '两次输入密码不一致'
                        },
                    }
                },
            }
        });
        $('#login_form').bootstrapValidator({
//        live: 'disabled',
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                loginname: {
                    validators: {
                        notEmpty: {
                            message: '登录名不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '瞪目名称长度在6-15个字母/数字之间'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\.]+$/,
                            message: '登录名只能包含字符数字'
                        },
                    }
                },
                password: {
                    validators: {
                        notEmpty: {
                            message: '密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '密码长度在6-15个字符之间'
                        },
                    }
                },
                confirmPassword: {
                    validators: {
                        notEmpty: {
                            message: '确认密码不能为空'
                        },
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: '密码长度在6-15个字符之间'
                        },
                        identical: {
                            field: 'password',
                            message: '两次输入密码不一致'
                        },
                    }
                },
            }
        });
    });
</script>
</html>